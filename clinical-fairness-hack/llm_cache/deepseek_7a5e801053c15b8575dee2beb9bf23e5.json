{
  "cache_key": "7a5e801053c15b8575dee2beb9bf23e5",
  "prompt": "\nGenerate ONLY executable Python code for: AIF360 Reweighing\n\nFunction signature: def apply_intervention(df: pd.DataFrame, sensitive_attr: str, outcome: str)\n- Use fairlearn or aif360 libraries\n- Include type hints and docstring\n- Return trained model object\n\nReturn ONLY Python code (no markdown, no explanations).\n",
  "response": "```python\nimport pandas as pd\nimport numpy as np\nfrom typing import Any\nfrom aif360.algorithms.preprocessing import Reweighing\nfrom aif360.datasets import StandardDataset\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.preprocessing import StandardScaler\n\ndef apply_intervention(df: pd.DataFrame, sensitive_attr: str, outcome: str) -> Any:\n    \"\"\"\n    Apply AIF360 Reweighing preprocessing intervention to mitigate bias.\n    \n    Args:\n        df: Input DataFrame containing features, sensitive attribute, and outcome\n        sensitive_attr: Name of the sensitive attribute column\n        outcome: Name of the binary outcome/target column (0/1)\n    \n    Returns:\n        Trained logistic regression model with reweighted samples\n    \"\"\"\n    # Create a copy to avoid modifying original dataframe\n    data = df.copy()\n    \n    # Prepare features and labels\n    feature_cols = [col for col in data.columns \n                   if col not in [sensitive_attr, outcome]]\n    \n    X = data[feature_cols].values\n    y = data[outcome].values\n    sensitive = data[sensitive_attr].values\n    \n    # Create StandardDataset for AIF360\n    dataset = StandardDataset(\n        df=data,\n        label_name=outcome,\n        favorable_classes=[1],\n        protected_attribute_names=[sensitive_attr],\n        privileged_classes=[[1]]  # Assuming 1 is privileged group\n    )\n    \n    # Apply Reweighing\n    RW = Reweighing(\n        unprivileged_groups=[{sensitive_attr: 0}],\n        privileged_groups=[{sensitive_attr: 1}]\n    )\n    dataset_transformed = RW.fit_transform(dataset)\n    \n    # Get transformed data with sample weights\n    X_transformed = dataset_transformed.features\n    y_transformed = dataset_transformed.labels.ravel()\n    sample_weights = dataset_transformed.instance_weights\n    \n    # Scale features\n    scaler = StandardScaler()\n    X_scaled = scaler.fit_transform(X_transformed)\n    \n    # Train model with reweighted samples\n    model = LogisticRegression(\n        random_state=42,\n        max_iter=1000,\n        class_weight='balanced'\n    )\n    model.fit(X_scaled, y_transformed, sample_weight=sample_weights)\n    \n    return model\n```",
  "temperature": 0.2,
  "timestamp": "2026-01-07T22:03:18.753150"
}