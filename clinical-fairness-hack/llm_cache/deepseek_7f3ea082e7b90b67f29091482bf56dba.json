{
  "cache_key": "7f3ea082e7b90b67f29091482bf56dba",
  "prompt": "\nGenerate ONLY executable Python code for: Fairlearn (Demographic Parity)\n\nFunction signature: def apply_intervention(df: pd.DataFrame, sensitive_attr: str, outcome: str)\n- Use fairlearn or aif360 libraries\n- Include type hints and docstring\n- Return trained model object\n\nReturn ONLY Python code (no markdown, no explanations).\n",
  "response": "```python\nimport pandas as pd\nimport numpy as np\nfrom typing import Any\nfrom fairlearn.reductions import ExponentiatedGradient, DemographicParity\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.preprocessing import StandardScaler, LabelEncoder\nfrom sklearn.pipeline import Pipeline\n\ndef apply_intervention(df: pd.DataFrame, sensitive_attr: str, outcome: str) -> Any:\n    \"\"\"\n    Apply Demographic Parity fairness intervention using Fairlearn.\n    \n    Parameters\n    ----------\n    df : pd.DataFrame\n        Input dataframe containing features, sensitive attribute, and outcome\n    sensitive_attr : str\n        Name of the sensitive attribute column\n    outcome : str\n        Name of the binary outcome column\n        \n    Returns\n    -------\n    Any\n        Trained fair model object\n    \"\"\"\n    \n    # Prepare data\n    X = df.drop(columns=[sensitive_attr, outcome]).copy()\n    y = df[outcome].copy()\n    sensitive_features = df[sensitive_attr].copy()\n    \n    # Encode categorical sensitive features if needed\n    if sensitive_features.dtype == 'object' or sensitive_features.dtype.name == 'category':\n        le = LabelEncoder()\n        sensitive_features = le.fit_transform(sensitive_features)\n    \n    # Create base estimator\n    base_estimator = Pipeline([\n        ('scaler', StandardScaler()),\n        ('classifier', LogisticRegression(random_state=42, max_iter=1000))\n    ])\n    \n    # Apply Demographic Parity constraint\n    constraint = DemographicParity()\n    \n    # Use ExponentiatedGradient reduction\n    mitigator = ExponentiatedGradient(\n        estimator=base_estimator,\n        constraints=constraint,\n        eps=0.01,\n        max_iter=50,\n        eta0=2.0\n    )\n    \n    # Train the fair model\n    mitigator.fit(X, y, sensitive_features=sensitive_features)\n    \n    return mitigator\n```",
  "temperature": 0.2,
  "timestamp": "2026-01-07T22:02:45.214546"
}